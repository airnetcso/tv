<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kosa Kata Korea - Super Friendly</title>
    <style>
        body { font-family: Arial, sans-serif; background: #e8f5e9; margin: 0; padding: 10px; }
        .container { max-width: 100%; margin: auto; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
        h1 { font-size: 26px; text-align: center; margin: 15px 0; color: #2e7d32; }
        input[type="text"] { width: 100%; padding: 20px; margin: 20px 0; font-size: 24px; border-radius: 12px; border: 3px solid #a5d6a7; box-sizing: border-box; text-align: center; }
        button { width: 100%; padding: 20px; margin: 12px 0; font-size: 22px; border-radius: 12px; border: none; color: white; font-weight: bold; cursor: pointer; }
        .btn-start { background: #4caf50; }
        .btn-next { background: #43a047; }
        .btn-submit { background: #2e7d32; }
        .btn-voice { background: #1976d2; font-size: 32px; padding: 30px; box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
        .hidden { display: none; }
        #timer { text-align: center; font-size: 28px; color: #d50000; font-weight: bold; margin: 20px 0; background: #ffebee; padding: 10px; border-radius: 10px; }
        .progress { height: 12px; background: #c8e6c9; border-radius: 6px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: #4caf50; width: 0%; transition: width 0.4s; }
        .question strong { font-size: 36px; display: block; margin: 40px 0; color: #2e7d32; }
        .hint { font-size: 18px; color: #33691e; text-align: center; font-weight: bold; margin: 15px 0; }
        .wrong-list { font-size: 18px; line-height: 1.8; margin: 20px 0; background: #fff3e0; padding: 15px; border-radius: 10px; }
        .wrong-item { margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container" id="loginPage">
        <h1>üåü Kosa Kata Korea<br>Super Friendly Mode</h1>
        <p style="text-align:center; font-size:18px;">50 soal ‚Ä¢ 30 menit ‚Ä¢ Pilih cara jawab!</p>
        <input type="text" id="username" placeholder="Nama kamu?">
        <button class="btn-start" onclick="login()">Mulai</button>
    </div>

    <div class="container hidden" id="menuPage">
        <h1>Halo, <span id="userName"></span>! üíö</h1>
        <p style="font-size:18px;">Pilih arah terjemahan</p>
        <button class="btn-start" onclick="chooseAnswerMode('koreaToIndo')">Korea ‚Üí Indonesia</button>
        <button class="btn-start" onclick="chooseAnswerMode('indoToKorea')">Indonesia ‚Üí Korea</button>
    </div>

    <!-- Pilih cara jawab -->
    <div class="container hidden" id="answerModePage">
        <h1>Pilih Cara Jawab</h1>
        <p style="font-size:18px;">Mau jawab dengan ketik atau bicara?</p>
        <button class="btn-start" onclick="startWithMode(selectedDirection, 'text')">üìù Ketik Manual</button>
        <button class="btn-start" onclick="startWithMode(selectedDirection, 'voice')">üîä Bicara (Suara)</button>
    </div>

    <div class="container hidden" id="quizPage">
        <h1 id="quizTitle">Semangat!</h1>
        <div id="timer">Waktu: 30:00</div>
        <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
        
        <div style="text-align:center;">
            <div class="question" id="quiz"></div>
            <p class="hint" id="hintText"></p>
            
            <input type="text" id="textAnswer" class="hidden" placeholder="Ketik jawaban...">
            <button class="btn-voice hidden" id="voiceBtn" onclick="startVoice()">üîä BICARA SEKARANG</button>
        </div>

        <button class="btn-next" id="nextBtn" onclick="nextQuestion()">Lanjut ‚Üí</button>
        <button class="btn-submit hidden" id="submitBtn" onclick="submitQuiz()">Lihat Hasil</button>
    </div>

    <div class="container hidden" id="resultPage">
        <h1>üéâ Mantap Bro!</h1>
        <p id="scoreText" style="font-size:28px; text-align:center; margin:30px 0; line-height:1.6;"></p>
        <div id="wrongAnswers" class="wrong-list hidden">
            <strong>Yang salah (untuk belajar ya üòä):</strong><br>
        </div>
        <button class="btn-start" onclick="backToMenu()">Latihan Lagi</button>
    </div>

    <script>
        // Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        if (recognition) {
            recognition.lang = 'id-ID';
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                nextQuestion(transcript); // langsung lanjut kalau suara
            };
            recognition.onerror = () => alert('Gagal dengar suara, coba lagi ya!');
        }

        function startVoice() {
            if (!recognition) return alert('Browser belum support suara, pilih mode ketik aja ya üòÖ');
            recognition.start();
            document.getElementById('voiceBtn').innerText = 'üî¥ Sedang Mendengar...';
        }

        // Sinonim & toleransi santai
        const synonyms = {
            "sayur": ["sayuran", "sayur-sayuran"],
            "malam": ["malem"],
            "satu": ["1"], "dua": ["2"], "tiga": ["3"], "empat": ["4"], "lima": ["5"],
            "halo": ["haloo", "hello", "hi"],
            "terima kasih": ["thanks", "makasih", "thank you"],
            "maaf": ["sorry", "mohon maaf"]
        };

        function normalizeAnswer(answer) {
            let norm = answer.toLowerCase().trim();
            for (const [key, vals] of Object.entries(synonyms)) {
                if (vals.some(v => norm.includes(v.toLowerCase()))) return key;
            }
            return norm;
        }

        function levenshtein(a, b) {
            a = a.toLowerCase(); b = b.toLowerCase();
            const bLen = b.length, aLen = a.length;
            const matrix = Array(bLen + 1).fill().map(() => Array(aLen + 1).fill(0));
            for (let i = 0; i <= aLen; i++) matrix[0][i] = i;
            for (let j = 0; j <= bLen; j++) matrix[j][0] = j;
            for (let j = 1; j <= bLen; j++) {
                for (let i = 1; i <= aLen; i++) {
                    const ind = a[i - 1] === b[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(matrix[j][i - 1] + 1, matrix[j - 1][i] + 1, matrix[j - 1][i - 1] + ind);
                }
            }
            return matrix[bLen][aLen];
        }

        const vocabulary = [
            {korea: "ÏÇ¨Í≥º", indo: "apel"}, {korea: "Î¨º", indo: "air"}, {korea: "Ï±Ö", indo: "buku"},
            {korea: "Ïßë", indo: "rumah"}, {korea: "ÏûêÎèôÏ∞®", indo: "mobil"}, {korea: "ÌïôÍµê", indo: "sekolah"},
            {korea: "ÏπúÍµ¨", indo: "teman"}, {korea: "Í∞ÄÏ°±", indo: "keluarga"}, {korea: "Î∞•", indo: "nasi"},
            {korea: "Í≥†ÏñëÏù¥", indo: "kucing"}, {korea: "Í∞ú", indo: "anjing"}, {korea: "ÏóÑÎßà", indo: "ibu"},
            {korea: "ÏïÑÎπ†", indo: "ayah"}, {korea: "ÏïàÎÖïÌïòÏÑ∏Ïöî", indo: "halo"}, {korea: "Í∞êÏÇ¨Ìï©ÎãàÎã§", indo: "terima kasih"},
            {korea: "ÎØ∏ÏïàÌï©ÎãàÎã§", indo: "maaf"}, {korea: "ÎÑ§", indo: "ya"}, {korea: "ÏïÑÎãàÏöî", indo: "tidak"},
            {korea: "Ïª§Ìîº", indo: "kopi"}, {korea: "Îπµ", indo: "roti"}, {korea: "Ïö∞Ïú†", indo: "susu"},
            {korea: "Í≥ºÏùº", indo: "buah"}, {korea: "Ï±ÑÏÜå", indo: "sayur"}, {korea: "ÌïòÎÇò", indo: "satu"},
            {korea: "Îëò", indo: "dua"}, {korea: "ÏÖã", indo: "tiga"}, {korea: "ÎÑ∑", indo: "empat"},
            {korea: "Îã§ÏÑØ", indo: "lima"}, {korea: "Îπ®Í∞ï", indo: "merah"}, {korea: "ÌååÎûë", indo: "biru"},
            {korea: "ÎÖ∏Îûë", indo: "kuning"}, {korea: "Í≤ÄÏ†ï", indo: "hitam"}, {korea: "ÌïòÏñë", indo: "putih"},
            {korea: "Ï¢ãÏïÑÌïòÎã§", indo: "suka"}, {korea: "Î®πÎã§", indo: "makan"}, {korea: "ÎßàÏãúÎã§", indo: "minum"},
            {korea: "Í∞ÄÎã§", indo: "pergi"}, {korea: "Ïò§Îã§", indo: "datang"}, {korea: "Î≥¥Îã§", indo: "melihat"},
            {korea: "ÌÅ∞", indo: "besar"}, {korea: "ÏûëÏùÄ", indo: "kecil"}, {korea: "ÏòàÏÅòÎã§", indo: "cantik"},
            {korea: "Î©ãÏûàÎã§", indo: "keren"}, {korea: "Î∞∞Í≥†ÌîÑÎã§", indo: "lapar"}, {korea: "Î™©ÎßàÎ•¥Îã§", indo: "haus"},
            {korea: "Ï°∏Î¶¨Îã§", indo: "ngantuk"}, {korea: "Ïù¥Î¶Ñ", indo: "nama"}, {korea: "ÌïôÏÉù", indo: "pelajar"},
            {korea: "ÏÑ†ÏÉùÎãò", indo: "guru"}, {korea: "ÌïúÍµ≠", indo: "korea"}
        ];

        let currentUser = '', mode = '', answerMode = '', selectedDirection = '';
        let questions = [], currentQuestion = 0, userAnswers = [];
        let timerInterval, timeLeft = 1800;

        function login() {
            const user = document.getElementById('username').value.trim();
            if (!user) return alert('Isi nama dulu ya!');
            currentUser = user;
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('menuPage').classList.remove('hidden');
            document.getElementById('userName').innerText = user;
        }

        function chooseAnswerMode(direction) {
            selectedDirection = direction;
            document.getElementById('menuPage').classList.add('hidden');
            document.getElementById('answerModePage').classList.remove('hidden');
        }

        function startWithMode(direction, chosenMode) {
            mode = direction;
            answerMode = chosenMode;
            questions = [...vocabulary].sort(() => 0.5 - Math.random());
            currentQuestion = 0;
            userAnswers = [];
            document.getElementById('answerModePage').classList.add('hidden');
            document.getElementById('quizPage').classList.remove('hidden');
            document.getElementById('quizTitle').innerText = mode === 'koreaToIndo' ? 'Korea ‚Üí Indonesia' : 'Indonesia ‚Üí Korea';

            if (answerMode === 'voice') {
                document.getElementById('textAnswer').classList.add('hidden');
                document.getElementById('voiceBtn').classList.remove('hidden');
                document.getElementById('hintText').innerText = 'Tekan tombol üîä lalu bicara jawaban';
            } else {
                document.getElementById('textAnswer').classList.remove('hidden');
                document.getElementById('voiceBtn').classList.add('hidden');
                document.getElementById('hintText').innerText = 'Ketik jawaban di bawah';
            }

            showQuestion();
            startTimer();
        }

        function showQuestion() {
            const q = questions[currentQuestion];
            const word = mode === 'koreaToIndo' ? q.korea : q.indo;
            document.getElementById('quiz').innerHTML = `<strong>${word}</strong>`;
            document.getElementById('textAnswer').value = '';
            document.getElementById('voiceBtn').innerText = 'üîä BICARA SEKARANG';

            document.getElementById('progressBar').style.width = `${((currentQuestion + 1)/questions.length)*100}%`;

            if (currentQuestion === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('submitBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('submitBtn').classList.add('hidden');
            }
        }

        function nextQuestion(autoAnswer = null) {
            let answer = autoAnswer || document.getElementById('textAnswer').value.trim();
            if (!answer) return alert('Jawab dulu ya bro! üí™');

            userAnswers.push(answer);
            currentQuestion++;
            if (currentQuestion < questions.length) showQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const min = Math.floor(timeLeft / 60);
                const sec = timeLeft % 60;
                document.getElementById('timer').innerText = `Waktu: ${min}:${sec < 10 ? '0'+sec : sec}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            if (answerMode === 'voice' && currentQuestion === questions.length) {
                // kalau suara terakhir belum diisi, skip atau beri 0
            }

            let score = 0;
            let wrongList = '';

            questions.forEach((q, i) => {
                const correct = (mode === 'koreaToIndo' ? q.indo : q.korea);
                const userAns = normalizeAnswer(userAnswers[i] || '');
                const distance = levenshtein(userAns, correct.toLowerCase());
                if (userAns === correct.toLowerCase() || distance <= 2) {
                    score++;
                } else if (userAnswers[i]) {
                    const wordShown = mode === 'koreaToIndo' ? q.korea : q.indo;
                    wrongList += `<div class="wrong-item">‚Ä¢ <strong>${wordShown}</strong> ‚Üí kamu: "${userAnswers[i]}" (benar: <strong>${correct}</strong>)</div>`;
                }
            });

            document.getElementById('quizPage').classList.add('hidden');
            document.getElementById('resultPage').classList.remove('hidden');

            let message = `${currentUser}!\nKamu benar ${score} dari 50 soal! üåü\n\n`;
            if (score >= 40) message += "Hebat banget! Kamu sudah pro nih! üöÄ";
            else if (score >= 30) message += "Bagus sekali! Tinggal sedikit lagi jadi master üòé";
            else if (score >= 20) message += "Lumayan! Latihan terus, pasti naik terus üí™";
            else message += "Tenang bro, ini baru pemanasan! Besok pasti lebih jago üî•";

            document.getElementById('scoreText').innerText = message;

            if (wrongList) {
                document.getElementById('wrongAnswers').innerHTML = wrongList;
                document.getElementById('wrongAnswers').classList.remove('hidden');
            }
        }

        function backToMenu() {
            document.getElementById('resultPage').classList.add('hidden');
            document.getElementById('menuPage').classList.remove('hidden');
            timeLeft = 1800;
        }
    </script>
</body>
</html>
