<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kelas Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; text-align: center; background: #f1f5f9; }
video { width: 90%; max-width: 600px; background: black; margin: 10px auto; display: block; }
button { padding: 10px 15px; margin: 5px; }
</style>
</head>

<body>

<h2>ðŸ“š Kelas Online</h2>

<video id="video" autoplay playsinline></video>

<button onclick="startCamera()">Kamera Guru</button>
<button onclick="shareScreen()">Share Screen</button>

<script>
// ================= FIREBASE =================
const firebaseConfig = {
  apiKey: "ISI_PUNYA_LO",
  authDomain: "ISI_PUNYA_LO",
  databaseURL: "ISI_PUNYA_LO",
  projectId: "ISI_PUNYA_LO",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= WEBRTC =================
const video = document.getElementById("video");
const pc = new RTCPeerConnection();
const room = new URLSearchParams(location.search).get("room") || "kelas1";

pc.ontrack = e => video.srcObject = e.streams[0];

async function startCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  stream.getTracks().forEach(t => pc.addTrack(t, stream));
  video.srcObject = stream;

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  db.ref("rooms/" + room + "/offer").set(offer);
}

async function shareScreen() {
  const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
  stream.getTracks().forEach(t => pc.addTrack(t, stream));
}

// ================= STUDENT =================
db.ref("rooms/" + room + "/offer").on("value", async snap => {
  if (!snap.val() || pc.currentRemoteDescription) return;

  await pc.setRemoteDescription(snap.val());
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  db.ref("rooms/" + room + "/answer").set(answer);
});

db.ref("rooms/" + room + "/answer").on("value", async snap => {
  if (snap.val() && !pc.currentRemoteDescription)
    await pc.setRemoteDescription(snap.val());
});
</script>

</body>
</html>
