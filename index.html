<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kosa Kata Korea - Friendly Hard Mode</title>
    <style>
        body { font-family: Arial, sans-serif; background: #e8f5e9; margin: 0; padding: 10px; }
        .container { max-width: 100%; margin: auto; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
        h1 { font-size: 26px; text-align: center; margin: 15px 0; color: #2e7d32; }
        input[type="text"] { width: 100%; padding: 20px; margin: 20px 0; font-size: 24px; border-radius: 12px; border: 3px solid #a5d6a7; box-sizing: border-box; text-align: center; }
        button { width: 100%; padding: 20px; margin: 15px 0; font-size: 22px; border-radius: 12px; border: none; color: white; font-weight: bold; cursor: pointer; }
        .btn-start { background: #4caf50; }
        .btn-next { background: #43a047; }
        .btn-submit { background: #2e7d32; }
        .btn-voice { background: #1976d2; font-size: 28px; padding: 18px; }
        .hidden { display: none; }
        #timer { text-align: center; font-size: 28px; color: #d50000; font-weight: bold; margin: 20px 0; background: #ffebee; padding: 10px; border-radius: 10px; }
        .progress { height: 12px; background: #c8e6c9; border-radius: 6px; margin: 20px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: #4caf50; width: 0%; transition: width 0.4s; }
        .question strong { font-size: 36px; display: block; margin: 40px 0; color: #2e7d32; }
        .hint { font-size: 18px; color: #33691e; text-align: center; font-weight: bold; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container" id="loginPage">
        <h1>ðŸŒŸ Kosa Kata Korea<br>Friendly Hard Mode</h1>
        <p style="text-align:center; font-size:18px;">50 soal â€¢ 30 menit â€¢ Bicara/Ketik â€¢ Ada toleransi arti & ejaan santai!</p>
        <input type="text" id="username" placeholder="Nama kamu?">
        <button class="btn-start" onclick="login()">Mulai Latihan</button>
    </div>

    <div class="container hidden" id="menuPage">
        <h1>Halo, <span id="userName"></span>! ðŸ’š</h1>
        <button class="btn-start" onclick="startTest('koreaToIndo')">Korea â†’ Indonesia</button>
        <button class="btn-start" onclick="startTest('indoToKorea')">Indonesia â†’ Korea</button>
    </div>

    <div class="container hidden" id="quizPage">
        <h1 id="quizTitle">Semangat Ya!</h1>
        <div id="timer">Waktu: 30:00</div>
        <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
        
        <div style="text-align:center;">
            <div class="question" id="quiz"></div>
            <p class="hint">Bicara atau ketik jawaban<br>(ada toleransi ejaan & variasi arti ðŸ˜Š)</p>
            <input type="text" id="textAnswer" placeholder="Jawab di sini..." autocomplete="off">
            <button class="btn-voice" onclick="startVoice()">ðŸ”Š Bicara Jawaban</button>
        </div>

        <button class="btn-next" id="nextBtn" onclick="nextQuestion()">Lanjut â†’</button>
        <button class="btn-submit hidden" id="submitBtn" onclick="submitQuiz()">Lihat Hasil</button>
    </div>

    <div class="container hidden" id="resultPage">
        <h1>ðŸŽ‰ Mantap Bro!</h1>
        <p id="scoreText" style="font-size:28px; text-align:center; margin:30px 0; line-height:1.6;"></p>
        <button class="btn-start" onclick="backToMenu()">Latihan Lagi</button>
    </div>

    <script>
        // Speech Recognition (browser built-in)
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        if (recognition) {
            recognition.lang = 'id-ID';
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                document.getElementById('textAnswer').value = transcript;
            };
            recognition.onerror = () => alert('Gagal dengar suara, coba lagi ya!');
        }

        function startVoice() {
            if (!recognition) return alert('Browser kamu belum support suara bro ðŸ˜… Ketik manual aja ya!');
            recognition.start();
        }

        // Daftar toleransi sinonim & variasi santai
        const synonyms = {
            "sayur": ["sayuran", "sayur-sayuran", "vegetable"],
            "malam": ["malem"],
            "satu": ["1", "satu "],
            "dua": ["2"],
            "tiga": ["3"],
            "empat": ["4"],
            "lima": ["5"],
            "halo": ["haloo", "hello", "hi"],
            "nasi": ["beras", "makan"], // toleransi longgar
            "terima kasih": ["thanks", "makasih", "thank you"],
            "maaf": ["sorry", "mohon maaf"]
            // Tambah lagi kalau mau
        };

        function normalizeAnswer(answer) {
            let norm = answer.toLowerCase().trim();
            // Ganti variasi umum
            for (const [key, vals] of Object.entries(synonyms)) {
                if (vals.some(v => norm.includes(v.toLowerCase()))) return key;
            }
            return norm;
        }

        function levenshtein(a, b) {
            a = a.toLowerCase();
            b = b.toLowerCase();
            const matrix = Array(b.length + 1).fill().map(() => Array(a.length + 1).fill(0));
            for (let i = 0; i <= a.length; i++) matrix[0][i] = i;
            for (let j = 0; j <= b.length; j++) matrix[j][0] = j;
            for (let j = 1; j <= b.length; j++) {
                for (let i = 1; i <= a.length; i++) {
                    const ind = a[i - 1] === b[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(
                        matrix[j][i - 1] + 1,
                        matrix[j - 1][i] + 1,
                        matrix[j - 1][i - 1] + ind
                    );
                }
            }
            return matrix[b.length][a.length];
        }

        const vocabulary = [
            {korea: "ì‚¬ê³¼", indo: "apel"},
            {korea: "ë¬¼", indo: "air"},
            {korea: "ì±…", indo: "buku"},
            {korea: "ì§‘", indo: "rumah"},
            {korea: "ìžë™ì°¨", indo: "mobil"},
            {korea: "í•™êµ", indo: "sekolah"},
            {korea: "ì¹œêµ¬", indo: "teman"},
            {korea: "ê°€ì¡±", indo: "keluarga"},
            {korea: "ë°¥", indo: "nasi"},
            {korea: "ê³ ì–‘ì´", indo: "kucing"},
            {korea: "ê°œ", indo: "anjing"},
            {korea: "ì—„ë§ˆ", indo: "ibu"},
            {korea: "ì•„ë¹ ", indo: "ayah"},
            {korea: "ì•ˆë…•í•˜ì„¸ìš”", indo: "halo"},
            {korea: "ê°ì‚¬í•©ë‹ˆë‹¤", indo: "terima kasih"},
            {korea: "ë¯¸ì•ˆí•©ë‹ˆë‹¤", indo: "maaf"},
            {korea: "ë„¤", indo: "ya"},
            {korea: "ì•„ë‹ˆìš”", indo: "tidak"},
            {korea: "ì»¤í”¼", indo: "kopi"},
            {korea: "ë¹µ", indo: "roti"},
            {korea: "ìš°ìœ ", indo: "susu"},
            {korea: "ê³¼ì¼", indo: "buah"},
            {korea: "ì±„ì†Œ", indo: "sayur"},
            {korea: "í•˜ë‚˜", indo: "satu"},
            {korea: "ë‘˜", indo: "dua"},
            {korea: "ì…‹", indo: "tiga"},
            {korea: "ë„·", indo: "empat"},
            {korea: "ë‹¤ì„¯", indo: "lima"},
            {korea: "ë¹¨ê°•", indo: "merah"},
            {korea: "íŒŒëž‘", indo: "biru"},
            {korea: "ë…¸ëž‘", indo: "kuning"},
            {korea: "ê²€ì •", indo: "hitam"},
            {korea: "í•˜ì–‘", indo: "putih"},
            {korea: "ì¢‹ì•„í•˜ë‹¤", indo: "suka"},
            {korea: "ë¨¹ë‹¤", indo: "makan"},
            {korea: "ë§ˆì‹œë‹¤", indo: "minum"},
            {korea: "ê°€ë‹¤", indo: "pergi"},
            {korea: "ì˜¤ë‹¤", indo: "datang"},
            {korea: "ë³´ë‹¤", indo: "melihat"},
            {korea: "í°", indo: "besar"},
            {korea: "ìž‘ì€", indo: "kecil"},
            {korea: "ì˜ˆì˜ë‹¤", indo: "cantik"},
            {korea: "ë©‹ìžˆë‹¤", indo: "keren"},
            {korea: "ë°°ê³ í”„ë‹¤", indo: "lapar"},
            {korea: "ëª©ë§ˆë¥´ë‹¤", indo: "haus"},
            {korea: "ì¡¸ë¦¬ë‹¤", indo: "ngantuk"},
            {korea: "ì´ë¦„", indo: "nama"},
            {korea: "í•™ìƒ", indo: "pelajar"},
            {korea: "ì„ ìƒë‹˜", indo: "guru"},
            {korea: "í•œêµ­", indo: "korea"}
        ];

        let currentUser = '';
        let mode = '';
        let questions = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let timerInterval;
        let timeLeft = 1800;

        function login() {
            const user = document.getElementById('username').value.trim();
            if (!user) return alert('Isi nama dulu ya!');
            currentUser = user;
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('menuPage').classList.remove('hidden');
            document.getElementById('userName').innerText = user;
        }

        function startTest(selectedMode) {
            mode = selectedMode;
            questions = [...vocabulary].sort(() => 0.5 - Math.random());
            currentQuestion = 0;
            userAnswers = [];
            document.getElementById('menuPage').classList.add('hidden');
            document.getElementById('quizPage').classList.remove('hidden');
            document.getElementById('quizTitle').innerText = mode === 'koreaToIndo' ? 'Korea â†’ Indonesia' : 'Indonesia â†’ Korea';
            showQuestion();
            startTimer();
        }

        function showQuestion() {
            const q = questions[currentQuestion];
            const word = mode === 'koreaToIndo' ? q.korea : q.indo;
            document.getElementById('quiz').innerHTML = `<strong>${word}</strong>`;
            document.getElementById('textAnswer').value = '';
            document.getElementById('textAnswer').focus();

            document.getElementById('progressBar').style.width = `${((currentQuestion + 1)/questions.length)*100}%`;

            if (currentQuestion === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('submitBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('submitBtn').classList.add('hidden');
            }
        }

        function nextQuestion() {
            const answer = document.getElementById('textAnswer').value.trim();
            if (!answer) return alert('Jawab dulu ya, semangat! ðŸ’ª');

            userAnswers.push(answer);
            currentQuestion++;
            if (currentQuestion < questions.length) showQuestion();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const min = Math.floor(timeLeft / 60);
                const sec = timeLeft % 60;
                document.getElementById('timer').innerText = `Waktu: ${min}:${sec < 10 ? '0'+sec : sec}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitQuiz();
                }
            }, 1000);
        }

        function submitQuiz() {
            clearInterval(timerInterval);
            const lastAnswer = document.getElementById('textAnswer').value.trim();
            if (lastAnswer && currentQuestion === questions.length) {
                userAnswers.push(lastAnswer);
            }

            let score = 0;
            questions.forEach((q, i) => {
                const correct = (mode === 'koreaToIndo' ? q.indo : q.korea);
                const userAns = normalizeAnswer(userAnswers[i] || '');
                const distance = levenshtein(userAns, correct.toLowerCase());
                if (userAns === correct.toLowerCase() || distance <= 2) score++;
            });

            document.getElementById('quizPage').classList.add('hidden');
            document.getElementById('resultPage').classList.remove('hidden');

            let message = `${currentUser}!\nKamu berhasil ${score} dari 50 soal! ðŸŒŸ\n\n`;
            if (score >= 40) message += "Wah hebat banget! Kamu sudah jago nih! ðŸš€";
            else if (score >= 30) message += "Bagus sekali! Tingkatkan lagi ya, pasti bisa! ðŸ’š";
            else if (score >= 20) message += "Lumayan bro! Latihan terus, kamu pasti naik skornya ðŸ˜Š";
            else message += "Tenang aja, ini baru awal! Besok coba lagi, pasti lebih baik ðŸ’ª Kamu sudah keren berani tantang 50 soal!";

            document.getElementById('scoreText').innerText = message;

            console.log(`HASIL | User: ${currentUser} | Skor: ${score}/50`);
        }

        function backToMenu() {
            document.getElementById('resultPage').classList.add('hidden');
            document.getElementById('menuPage').classList.remove('hidden');
            timeLeft = 1800;
        }
    </script>
</body>
</html>
